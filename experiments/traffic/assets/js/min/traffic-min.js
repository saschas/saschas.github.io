function getRandomColor(){for(var e="0123433333000ccc".split(""),n="#",i=0;6>i;i++)n+=e[Math.floor(16*Math.random())];return n}function randomNumber(e,n,i){var t=Math.floor(Math.random()*n)+e;return(i||"undefined"==typeof i)&&(t*=1==Math.floor(2*Math.random())?1:-1),t}function get_intensity(e){return 100*e/255}function clamp(e,n,i){return n>e&&(e=n),e>i&&(e=i),e}function add_car(e,n){var i=new THREE.Mesh(e,car_paint_Material);return i.castShadow=!0,i.scale.set(1.5,1.5,1.5),i.update=function(e){this.position.x-=.2+randomNumber(.2,.85,!1),this.position.x<-100&&(this.position.x=160)},i}function traffic(){for(var e=0,n=5,i=10,t=0;n>t;t++)for(var a=0;i>a;a++){e++;var r=add_car(å.loaded[randomNumber(0,å.loaded.length,!1)],randomNumber(0,å.colors.length,!1));r.position.x+=25*e+randomNumber(0,3,!1),r.position.z+=10*t,traffic_holder.add(r),e>i&&(e=0)}traffic_holder.position.x-=60,traffic_holder.position.z-=20,scene.add(traffic_holder)}function texter(){c.lineWidth=15,c.strokeRect(window.innerWidth/2-200,window.innerHeight/2-50,400,100),c.fillStyle="black",c.font="80px Passion One",c.fontWeight="900",c.textAlign="center",c.textBaseline="middle",c.fillText("TRAFFIC",window.innerWidth/2,window.innerHeight/2)}function start_scene(){container=document.getElementById("container"),renderer=new THREE.WebGLRenderer({antialias:!0,transparent:!0,alpha:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(5514295),container.appendChild(renderer.domElement),renderer.shadowMap.enabled=!0,scene=new THREE.Scene,scene.fog=new THREE.FogExp2(5514295,.008),camera=new THREE.PerspectiveCamera(105,window.innerWidth/window.innerHeight,1,1e4),camera.position.x=-31,camera.position.y=10,camera.position.z=-28,scene.add(camera),controls=new THREE.OrbitControls(camera),controls.addEventListener("change",render),controls.maxPolarAngle=Math.PI/2,controls.maxDistance=110;var e=new THREE.AmbientLight(11365343,1);scene.add(e),rim_light=new THREE.SpotLight(16777215,10,550,Math.PI/2),rim_light.position.set(0,500,-10).multiplyScalar(1),rim_light.castShadow=!0,rim_light.shadow.mapSize.width=1024,rim_light.shadow.mapSize.height=1024;var n=350;rim_light.shadow.camera.left=-n,rim_light.shadow.camera.right=n,rim_light.shadow.camera.top=n,rim_light.shadow.camera.bottom=-n,rim_light.shadow.camera.near=.01,scene.add(rim_light);var i=new THREE.PlaneBufferGeometry(300,300,128),t=new THREE.MeshLambertMaterial({color:3355443,side:THREE.DoubleSide}),a=new THREE.Mesh(i,t);a.rotation.x=90*Math.PI/180,a.receiveShadow=!0,scene.add(a)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),å.size.x=window.innerWidth,å.size.y=window.innerHeight}function animate(e){requestAnimationFrame(animate),controls.update(),render(e)}function render(e){var n=.75*clock.getDelta();c.update(e),"undefined"!=traffic_holder.children&&traffic_holder.children.forEach(function(n,i){n.update(e)}),renderer.render(scene,camera)}var clock=new THREE.Clock,helper,time=0,traffic_holder=new THREE.Object3D,texture_car_paint=document.getElementById("texture_car"),schalen=[],c,å={ready:{count:0},colors:[[14685487,627402,6710886,4473924,13421772],[16165486,14545663,6710886,4473924,13421772],[65327,627402,6710886,4473924,13421772],[16777007,627402,6710886,4473924,13421772]],models:{truck:"assets/model/truck.json",pickup:"assets/model/pickup.json",normal:"assets/model/normal.json",cabrio:"assets/model/cabrio.json",limousine:"assets/model/limousine.json",wohnmobil:"assets/model/wohnmobil.json"},loaded:[],size:{x:window.innerWidth,y:window.innerHeight},targetList:[]},manager=new THREE.LoadingManager;manager.onProgress=function(e,n,i){n==i&&(traffic(),animate(time))};var loader=new THREE.JSONLoader(manager);for(asset in å.models)loader.load(å.models[asset],function(e,n){var i="";å.loaded.push(e)});var paint_=new THREE.MeshPhongMaterial({color:å.colors[1][0],shading:THREE.FlatShading}),glas_=new THREE.MeshPhongMaterial({color:å.colors[1][1],shading:THREE.FlatShading}),reifen_rahmen_=new THREE.MeshPhongMaterial({color:å.colors[1][2],shading:THREE.FlatShading}),reifen_=new THREE.MeshPhongMaterial({color:å.colors[1][3],shading:THREE.FlatShading,opacity:1}),reifen_inner=new THREE.MeshPhongMaterial({color:å.colors[1][4],shading:THREE.FlatShading,opacity:1}),car_paint_Material=new THREE.MeshFaceMaterial([paint_,glas_,reifen_rahmen_,reifen_,reifen_inner]),text_canvas=document.createElement("canvas");text_canvas.width=window.innerWidth,text_canvas.height=window.innerHeight,document.body.appendChild(text_canvas),c=text_canvas.getContext("2d"),c.fillStyle="#000",c.fillRect(0,0,window.innerWidth,window.innerHeight),c.globalCompositeOperation="destination-out",c.beginPath();for(var points=[],n=0;250>n;n++)points.push({x:randomNumber(0,å.size.x/2,!1),y:randomNumber(0,å.size.y/2,!1),speed:randomNumber(1,3,!1)});c.update=function(e){this.globalCompositeOperation="source-over",this.fillStyle="#000",this.fillRect(0,0,å.size.x,å.size.y),this.globalCompositeOperation="destination-out",texter(),c.rotate(-25*Math.PI/180);for(var n=0;n<points.length;n++)points[n].y+=points[n].speed,points[n].y>1.5*å.size.y&&(points[n].y=0),c.fillRect(points[n].x,points[n].y,12,22);c.rotate(25*Math.PI/180)},window.addEventListener("resize",onWindowResize,!1),start_scene();