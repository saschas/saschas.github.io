var Adjust={version:.01,dpr:window.devicePixelRatio,width:window.innerWidth*this.dpr,height:window.innerHeight*this.dpr,realWidth:window.innerWidth,realHeight:window.innerHeight,mouse:new THREE.Vector2,offset:new THREE.Vector3,objects:[],half:{width:.5*this.width/this.dpr,height:.5*this.height/this.dpr},raycaster:new THREE.Raycaster,selected:null,intersected:null,labels:[],disableMouse:!1};Adjust.init=function(t){this.camera=t.camera,this.bindEvents(),this.resize(t),this.plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(200,200,8,8),new THREE.MeshPhongMaterial({visible:!1})),scene.add(this.plane)},Adjust.bindEvents=function(){window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mouseup",this.onMouseUp,!1)},Adjust.randNum=function(t,e,s){var i=Math.floor(Math.random()*e)+t;return(s||"undefined"==typeof s)&&(i*=1==Math.floor(2*Math.random())?1:-1),i},Adjust.addPoints=function(t){if("object"==typeof this.elements){var e=document.getElementsByClassName(t),s=[];this.domElementsBool=!0;for(var i=0;i<this.elements.length;i++)s.push(this.elements[i]);for(var n=0;n<e.length;n++)s.push(e[n]);this.elements=s}else"undefined"!=typeof t?(this.elements=document.getElementsByClassName(t),this.domElementsBool=!0):console.warn("No argument! classname required")},Adjust.removePoints=function(){this.domElementsBool=!1;for(var t=0;t<this.elements.length;t++)this.elements[t].style="";this.elements=[]},Adjust.addLabel=function(t){this.updateLabelsBool=!0;for(var e=document.getElementsByClassName(t),s=0;s<e.length;s++)this.labels.push(e[s]),scene.children.forEach(function(t,i){t.name==e[s].dataset.label&&(e[s]._dirtyCustom=t)})},Adjust.updateSingleLabel=function(t){var e=0,s=0,i=0;"undefined"!=typeof t.dataset.offsetx&&(e=t.dataset.offsetx),"undefined"!=typeof t.dataset.offsety&&(s=t.dataset.offsety),"undefined"!=typeof t.dataset.offsetz&&(i=t.dataset.offsetz);var n=new THREE.Vector3,a={x:parseFloat(t._dirtyCustom.position.x)-e,y:parseFloat(t._dirtyCustom.position.y)-s,z:parseFloat(t._dirtyCustom.position.z)-i};return n.set(a.x,a.y,a.z),t.dataset.bound=this.pointInFrustum(n),this.convertVector(n),this.domElement(t,n),n},Adjust.resize=function(t){this.dpr=window.devicePixelRatio,this.width=t.holder.offsetWidth*this.dpr,this.height=t.holder.offsetHeight*this.dpr,this.realWidth=t.holder.offsetWidth,this.realHeight=t.holder.offsetHeight,this.half.width=.5*this.width/this.dpr,this.half.height=.5*this.height/this.dpr},Adjust.domElement=function(t,e,s){var i=t.getBoundingClientRect().width/2,n=t.getBoundingClientRect().height/2;e.x-=i,e.y-=n,e.z=Math.max(3-e.z,.1),t.style.webkitTransform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)",t.style.MozTransform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)",t.style.OTransform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)",t.style.transform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)","undefined"!=typeof s&&(t.dataset.bound=s)},Adjust.convertVector=function(t){return t.project(this.camera),t.x=t.x*this.half.width+this.half.width,t.y=-(t.y*this.half.height)+this.half.height,t.z=t.z*(this.half.width/this.half.height)/2+this.half.width/this.half.height*2,t},Adjust.element=function(t){var e=new THREE.Vector3;if("undefined"==typeof this.width&&this.init(),0==Object.keys(t.dataset).length)return console.warn("Missing data Attribute on Element:",t),!1;var s={x:parseFloat(t.dataset.x),y:parseFloat(t.dataset.y),z:parseFloat(t.dataset.z)};return e.set(s.x,s.y,s.z),t.dataset.bound=this.pointInFrustum(e),this.convertVector(e),this.domElement(t,e),e},Adjust.setMouse=function(t){return this.mouse=t,this.mouse},Adjust.normalizeMouse=function(t){var e={x:t.x/this.width*2-1,y:t.y/this.height*2+1,z:.5};return e},Adjust.onMouseMove=function(t){Adjust.setMouse({x:t.clientX,y:t.clientY,z:.5})},Adjust.checkSelected=function(){null!=this.intersected?(this.selected=this.intersected,this.selectedState(this.intersected)):this.selected=null},Adjust.uncheckSelected=function(){this.intersected&&("undefined"!=typeof this.passivState&&this.passivState(this.intersected),this.intersected._draggable&&this.plane.position.copy(this.intersected.position)),this.intersected=null,this.selected=null},Adjust.onMouseDown=function(t){Adjust.checkSelected()},Adjust.onMouseUp=function(t){Adjust.uncheckSelected()},Adjust.checkPointInRadius=function(t,e,s,i){var n=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z),a=[s*s*s>=n,n];return i(a[0],a[1]),a},Adjust.update=function(){if(this.domElementsBool)for(var t=0;t<this.elements.length;t++)this.element(this.elements[t]);if(this.updateLabelsBool)for(var e=0;e<this.labels.length;e++)this.updateSingleLabel(this.labels[e]);this.activeObjectUpdate&&this.checkMouseCollision()},Adjust.addActiveObject=function(t,e,s,i,n){this.activState=e,this.passivState=s,this.selectedState=i,this.activeObjectUpdate=!0,this.objects.push(t),this.addDraggable(t,n)},Adjust.addDraggable=function(t,e){t._draggable=e},Adjust.checkMouseCollision=function(){if(!this.disableMouse){var t=new THREE.Vector3;if(t.set(this.mouse.x/this.realWidth*2-1,2*-(this.mouse.y/this.realHeight)+1,.5),this.raycaster.setFromCamera(t,this.camera),null!=this.selected)return this.intersects=this.raycaster.intersectObject(this.plane),void(this.intersects.length>0&&(this.plane.position.copy(this.intersected.position),this.plane.lookAt(this.camera.position),this.intersected._draggable&&this.selected.position.copy(this.intersects[0].point.sub(this.offset))));this.intersects=this.raycaster.intersectObjects(this.objects),this.intersects.length>0?(this.intersected!=this.intersects[0].object&&(this.intersected&&this.passivState(this.intersected),this.intersected=this.intersects[0].object,this.plane.position.copy(this.intersected.position),this.plane.lookAt(this.camera.position)),this.intersected&&this.activState(this.intersected)):(this.intersected&&this.passivState(this.intersected),this.intersected=null,this.selected=null)}},Adjust.distanceToCamera=function(t){var e=t.x-this.camera.position.x,s=t.y-this.camera.position.y,i=t.z-this.camera.position.z;return Math.sqrt(e*e+s*s+i*i)},Adjust.objInFrustum=function(t){this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.camera.matrixWorldInverse.getInverse(camera.matrixWorld),t.updateMatrix(),t.updateMatrixWorld();var e=new THREE.Frustum;return e.setFromMatrix((new THREE.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse)),e.intersectsObject(t)},Adjust.pointInFrustum=function(t){this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.camera.matrixWorldInverse.getInverse(camera.matrixWorld);var e=new THREE.Frustum;return e.setFromMatrix((new THREE.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse)),e.containsPoint(t)},Adjust.mouseToSpace=function(){var t=new THREE.Vector3;t.set(this.mouse.x/this.realWidth*2-1,2*-(this.mouse.y/this.realHeight)+1,.5),t.unproject(this.camera);var e=t.sub(this.camera.position).normalize(),s=-this.camera.position.y/e.y,i=this.camera.position.clone().add(e.multiplyScalar(s));return i};