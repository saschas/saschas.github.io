function getRandomColor(){for(var e="0123433333000ccc".split(""),n="#",t=0;6>t;t++)n+=e[Math.floor(16*Math.random())];return n}function init(){container=document.getElementById("container"),camera=new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight,.1,1e4),camera.position.x=0,camera.position.y=0,camera.position.z=5,camera.update=function(e){},camera.move_direction=1,scene=new THREE.Scene,scene.fog=new THREE.FogExp2(16777215,.0015),scene.add(camera);var e=new THREE.MeshBasicMaterial({color:255,transparent:!0,opacity:0}),n=50,t=32,o=new THREE.CircleGeometry(n,t);camera_helper=new THREE.Mesh(o,e),scene.add(camera_helper),camera_helper.add(camera),camera_helper.visible=!0,camera.position.set(50,20,50),controls=new THREE.OrbitControls(camera),controls.damping=.2,controls.addEventListener("change",render),camera.lookAt(new THREE.Vector3(0,5,0)),controls.target=new THREE.Vector3(0,5,0),controls.minDistance=50,controls.maxDistance=160,controls.minPolarAngle=20*Math.PI/180,controls.maxPolarAngle=90*Math.PI/180,controls.minAzimuthAngle=-30*Math.PI/180,controls.maxAzimuthAngle=30*Math.PI/180;var i=new THREE.AmbientLight(16777215);scene.add(i),fake_light=new THREE.SpotLight(16777215,.5),fake_light.position.set(0,50,120),fake_light.castShadow=!0,fake_light.shadowMapWidth=2048,fake_light.shadowMapHeight=2048;var a=3500;fake_light.shadowCameraLeft=-a,fake_light.shadowCameraRight=a,fake_light.shadowCameraTop=2.8*a,fake_light.shadowCameraBottom=-a,fake_light.shadowCameraNear=.1,light=new THREE.SpotLight(16777215,.1),light.castShadow=!0,light.shadowMapWidth=2048,light.shadowMapHeight=2048;var a=3500;light.shadowCameraLeft=-a,light.shadowCameraRight=a,light.shadowCameraTop=2.8*a,light.shadowCameraBottom=-a,light.shadowCameraNear=.1,light.position.set(0,100,100),light.target.updateMatrixWorld(),light.update=function(e){this.position=camera_helper.position,this.target.position.set(camera_helper.position.x,0,camera_helper.position.z),this.target.updateMatrixWorld()},camera_helper.add(light),corr_light=new THREE.SpotLight(16777215,.1),corr_light.position.set(0,12,20),corr_light.target.position.set(0,6,0),corr_light.target.updateMatrixWorld(),scene.add(corr_light),renderer=new THREE.WebGLRenderer({antialias:!0,transparent:!0,alpha:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),renderer.shadowMapEnabled=!0;var r=new THREE.JSONLoader;r.load(å.models.minion,function(e,n){n.forEach(function(e,n){e.skinning=!0});var t=new THREE.MeshPhongMaterial({shading:THREE.SmoothShading,skinning:!0,shininess:200,map:minion_texture,side:THREE.DoubleSide,specularMap:minion_spec_texture,bumpMap:minion_bump_texture,bumpScale:.005}),o=new THREE.MeshPhongMaterial({shading:THREE.SmoothShading,skinning:!0,shininess:20,map:minion_yellow_texture,side:THREE.DoubleSide,specularMap:minion_spec_texture}),i=new THREE.MeshPhongMaterial({color:3913959,shading:THREE.SmoothShading,shininess:200,skinning:!0,side:THREE.DoubleSide,transparent:!0,opacity:.2}),a=new THREE.MeshPhongMaterial({color:0,shading:THREE.SmoothShading,shininess:200,skinning:!0,side:THREE.DoubleSide}),r=new THREE.MeshFaceMaterial([t,o,i,a]),s=[];minion=new THREE.SkinnedMesh(e,r),minion.geometry.colors=s,minion.geometry.colorsNeedUpdate=!0,minion.position.set(0,0,0),minion.scale.set(10,10,10),minion.receiveShadow=!0,minion.castShadow=!0,minion.direction=1,minion.update=function(e){animation.jump.timeScale=0,minion_movement(å.keymap),camera_helper.position.x=this.position.x,camera_helper.position.z=this.position.z,floor.position.x=this.position.x,floor.position.z=this.position.z},scene.add(minion),animation.jump=new THREE.Animation(minion,e.animation[1]),animation.jump.play(),animation.jump.timeScale=1,animation.walk=new THREE.Animation(minion,e.animation[0]),animation.walk.play(),animation.walk.timeScale=1,helper=new THREE.SkeletonHelper(minion),helper.material.linewidth=1,helper.visible=!1,scene.add(helper)});var s=new THREE.PlaneBufferGeometry(100,100,32),m=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide});floor=new THREE.Mesh(s,m),floor.rotation.x=-90*Math.PI/180,floor.receiveShadow=!0,scene.add(floor)}function ensureLoop(e){for(var n=0;n<e.hierarchy.length;n++){var t=e.hierarchy[n],o=e.hierarchy[0],i=e.hierarchy[e.hierarchy.length-1];i.pos=o.pos,i.rot=o.rot,i.scl=o.scl}}function boneLookAt(e,n){var t=new THREE.Vector3(n.x-e.matrixWorld.elements[12],n.y-e.matrixWorld.elements[13],n.z-e.matrixWorld.elements[14]).normalize(),o=new THREE.Vector3(0,0,1),i=(new THREE.Quaternion).setFromUnitVectors(o,t);i.x+=.1,e.quaternion.copy(i)}function keymapper(e){controls.enabled=!1,e.preventDefault(e),e=e||event,å.keymap[e.keyCode]="keydown"==e.type}function minion_movement(e){for(key in e)if(e[key])switch(key){case"32":animation.walk.timeScale=0,animation.jump.timeScale=5,å.current_skeleton="jump",minion.direction=1;break;case"38":minion.translateZ(.3),animation.walk.timeScale=5,å.current_skeleton="walk",minion.direction=1;break;case"40":minion.translateZ(-.3),animation.walk.timeScale=-5,å.current_skeleton="walk",minion.direction=-1;break;case"37":minion.rotation.y+=.05,camera_helper.rotation.y+=.05,å.current_skeleton="walk";break;case"39":minion.rotation.y-=.05,camera_helper.rotation.y-=.05,å.current_skeleton="walk"}}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function eye_movement(e,n){var t=n.clone();switch(t.x+=camera_helper.position.x,t.y+=camera_helper.position.y,t.z+=camera_helper.position.z,boneLookAt(e.skeleton.bones[4],t),eye_options.state){case"close":eye_options.current.top+=eye_options.speed*eye_options.direction.top,eye_options.current.bottom+=eye_options.speed*eye_options.direction.bottom,(eye_options.current.top>eye_options.stops.close.top||eye_options.current.top<0)&&(eye_options.direction.top*=-1),(eye_options.current.bottom>eye_options.stops.close.bottom||eye_options.current.bottom<0)&&(eye_options.direction.bottom*=-1),e.skeleton.bones[6].rotation.x=eye_options.current.top*Math.PI/180,e.skeleton.bones[7].rotation.x=-eye_options.current.bottom*Math.PI/180;break;case"bored":e.skeleton.bones[6].rotation.x=60*Math.PI/180,e.skeleton.bones[7].rotation.x=0*Math.PI/180;break;case"angry":e.skeleton.bones[6].rotation.x=55*Math.PI/180,e.skeleton.bones[7].rotation.x=-55*Math.PI/180;break;case"open":e.skeleton.bones[6].rotation.x=0*Math.PI/180,e.skeleton.bones[7].rotation.x=-0*Math.PI/180;break;case"complete_closed":e.skeleton.bones[6].rotation.x=65*Math.PI/180,e.skeleton.bones[7].rotation.x=-65*Math.PI/180}}function animate(){requestAnimationFrame(animate),render()}function render(e){theta+=.1;var n=clock.getDelta();if("undefined"!=typeof minion){var t=Math.floor(e/interpolation)+animOffset;void 0!==helper&&helper.update(),THREE.AnimationHandler.update(interpolation),minion.update(e),camera.update(e),light.update(e),eye_movement(minion,camera.position);var e=Date.now();prevTime=e}renderer.render(scene,camera)}var container,camera,camera_helper,scene,controls,raycaster=new THREE.Raycaster,renderer,clock=new THREE.Clock,time=0,duration=100,keyframes=4,interpolation=duration/keyframes,currentKeyframe=0,lastKeyframe=0,animOffset=1,radius=600,theta=0,prevTime=Date.now(),lamp_light,light,fake_light,mouseX=0,mouseY=0,animation={},hair,mesh,circle,controller_animation,helper,morph_logic,banane,floor,texture1,tv_screen,tv_context,å={ready:{count:0},current_skeleton:"default",keymap:{37:!1,38:!1,39:!1,40:!1},mouse:{x:0,y:0,z:.5},models:{minion:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/61062/minion.json"},targetList:[]},yellow_image=document.getElementById("texture_yellow_minion"),minion_yellow_texture=new THREE.Texture(yellow_image);minion_yellow_texture.minFilter=THREE.LinearFilter,minion_yellow_texture.needsUpdate=!0;var minion_image=document.getElementById("texture_minion"),minion_texture=new THREE.Texture(minion_image);minion_texture.minFilter=THREE.LinearFilter,minion_texture.needsUpdate=!0;var minion_spec_image=document.getElementById("texture_spec_minion"),minion_spec_texture=new THREE.Texture(minion_spec_image);minion_spec_texture.minFilter=THREE.LinearFilter,minion_spec_texture.needsUpdate=!0;var minion_bump_image=document.getElementById("texture_bump_minion"),minion_bump_texture=new THREE.Texture(minion_bump_image);minion_bump_texture.minFilter=THREE.LinearFilter,minion_bump_texture.needsUpdate=!0,init(),animate(),window.addEventListener("resize",onWindowResize,!1),window.addEventListener("keydown",keymapper,!1),window.addEventListener("keyup",keymapper,!1);var eye_options={current:{top:0,bottom:0},state:"bored",switchState:function(){var e=["close","bored","angry","open","complete_closed"];return e[Math.floor(Math.random()*e.length)]},speed:2,direction:{top:1,bottom:1},stops:{close:{top:65,bottom:65}}},current_eye=0;$("body").click(function(e){eye_options.state=eye_options.switchState()});var fps=24,keyframes=58,duration=keyframes/fps,interpolation=duration/keyframes;