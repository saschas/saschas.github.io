function drawStroker(a,e,t){var s=Math.sin(e*Math.PI/180)*t,n=Math.cos(e*Math.PI/180)*t;c.moveTo(a.x,a.y),c.lineTo(a.x,a.y),c.lineTo(a.x+s,a.y+n),c.stroke()}function drawKaleido(){for(var a=0,e=0;e<Math.ceil(Math.sqrt(mandala.slices));e++)a=0==e?1:Math.pow(2,e),c.save(),c.translate(stage.x*stage.dpr/2,stage.y*stage.dpr/2),c.rotate(360/mandala.slices*a*Math.PI/180),c.translate(-stage.x*stage.dpr/2,-stage.y*stage.dpr/2),c.drawImage(canvas,0,0),c.restore()}function drawHelper(){c.strokeStyle="#eee",c.lineWidth=1;for(var a=0;a<mandala.slices;a++)c.beginPath(),drawStroker({x:stage.x*stage.dpr/2,y:stage.y*stage.dpr/2},a*(360/mandala.slices),stage.y*stage.x),c.closePath()}function drawMandala(a){if(c.strokeStyle="#000",mouse.currentShape.length>1){c.beginPath(),c.strokeStyle=mouse.currentShape[0].color,c.lineWidth=mouse.currentShape[0].thickness;for(var e=1;e<mouse.currentShape.length;e++)1==e&&c.moveTo(mouse.currentShape[e].x,mouse.currentShape[e].y),c.lineTo(mouse.currentShape[e].x,mouse.currentShape[e].y);c.stroke(),c.closePath()}shapes.forEach(function(a,e){c.beginPath(),a.forEach(function(e,t){c.strokeStyle=a[0].color,c.lineWidth=a[0].thickness,c.lineTo(e.x,e.y)}),c.stroke(),c.closePath()})}function mousemove(a){mouse.x=(a.clientX-canvas.offsetLeft)*stage.dpr,mouse.y=(a.clientY-canvas.offsetTop)*stage.dpr,mouse.active&&mouse.currentShape.push({x:mouse.x,y:mouse.y})}function touchmove(a){a.preventDefault(),a.touches.length>0&&(mouse.x=(a.touches[0].clientX-canvas.offsetLeft)*stage.dpr,mouse.y=(a.touches[0].clientY-canvas.offsetTop)*stage.dpr,mouse.active&&mouse.currentShape.push({x:mouse.x,y:mouse.y}))}function mouseup(a){mouse.active=!1,shapes.push(mouse.currentShape)}function mousedown(a){mouse.ui="CANVAS"!==a.target.nodeName,mouse.active=!mouse.ui,mouse.currentShape=[{color:mandala.drawColor,thickness:mandala.thickness}]}try{var isFileSaverSupported=!!new Blob}catch(e){}var time=0,stage={x:window.innerWidth,y:window.innerHeight,dpr:window.devicePixelRatio};stage.x=stage.x<stage.y?stage.x:stage.y,stage.y=stage.y<stage.x?stage.y:stage.x;var bgCanvasElement=document.createElement("canvas"),bgCanvas=bgCanvasElement.getContext("2d");bgCanvasElement.style.display="none",document.body.appendChild(bgCanvasElement);var mouse={x:0,y:0,active:!1,currentShape:[],ui:!1},shapes=[],canvas=document.createElement("canvas");bgCanvasElement.width=canvas.width=stage.x*stage.dpr,bgCanvasElement.height=canvas.height=stage.y*stage.dpr,document.body.appendChild(canvas);var c=canvas.getContext("2d"),MandalaOptions=function(){this.sliceFactor=6,this.slices=Math.pow(2,this.sliceFactor),this.drawColor="#ffffff",this.backgroundColor="#333333",this.thickness=1,this.grid=!1,this.center=!0,this.transparentBG=!0,this.clear=function(){shapes=[]},this.saveAsPNG=function(){c.clearRect(0,0,stage.x*stage.dpr,stage.y*stage.dpr),drawMandala(time),drawKaleido(),bgCanvas.drawImage(canvas,0,0),bgCanvasElement.toBlob(function(a){saveAs(a,"my_personal_mandala.png")})}},mandala=new MandalaOptions,gui=new dat.GUI;gui.add(mandala,"sliceFactor",1,8).onChange(function(a){this.object.slices=Math.pow(2,Math.floor(a))}).step(1),gui.add(mandala,"grid"),gui.add(mandala,"center"),gui.add(mandala,"thickness",1,50).step(1),gui.add(mandala,"transparentBG").onChange(function(a){a?bgCanvas.clearRect(0,0,stage.x*stage.dpr,stage.y*stage.dpr):(bgCanvas.beginPath(),bgCanvas.arc(stage.x*stage.dpr/2,stage.y*stage.dpr/2,stage.x,0,2*Math.PI),bgCanvas.clip(),bgCanvas.closePath(),bgCanvas.fillStyle=mandala.backgroundColor,bgCanvas.fillRect(0,0,stage.x*stage.dpr,stage.y*stage.dpr))}),gui.addColor(mandala,"backgroundColor").onChange(function(a){bgCanvas.fillStyle=mandala.backgroundColor,bgCanvas.fillRect(0,0,stage.x*stage.dpr,stage.y*stage.dpr),document.body.style.backgroundColor=a}),gui.addColor(mandala,"drawColor"),gui.add(mandala,"clear"),gui.add(mandala,"saveAsPNG"),gui.close(),document.body.style.backgroundColor=mandala.backgroundColor,bgCanvas.beginPath(),bgCanvas.arc(stage.x*stage.dpr/2,stage.y*stage.dpr/2,stage.x,0,2*Math.PI),bgCanvas.clip(),bgCanvas.closePath(),mandala.transparentBG||(bgCanvas.fillStyle=mandala.backgroundColor,bgCanvas.fillRect(0,0,stage.x*stage.dpr,stage.y*stage.dpr)),window.addEventListener("mousemove",mousemove),window.addEventListener("touchmove",touchmove),window.addEventListener("touchstart",mousedown),window.addEventListener("mousedown",mousedown),window.addEventListener("touchend",mouseup),window.addEventListener("mouseup",mouseup),window.onresize=function(){stage.x=window.innerWidth,stage.y=window.innerHeight,stage.x=stage.x<stage.y?stage.x:stage.y,stage.y=stage.y<stage.x?stage.y:stage.x,bgCanvasElement.width=canvas.width=stage.x*stage.dpr,bgCanvasElement.height=canvas.height=stage.y*stage.dpr};var render=function(a){requestAnimationFrame(render),c.clearRect(0,0,stage.x*stage.dpr,stage.y*stage.dpr),drawMandala(a),drawKaleido(),mandala.grid&&drawHelper(),mandala.center&&(c.fillStyle="#fff",c.fillRect(stage.x*stage.dpr/2-1*stage.dpr/2,stage.y*stage.dpr/2-1*stage.dpr/2,1*stage.dpr,1*stage.dpr))};render(time);