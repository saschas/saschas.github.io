window.onload=function(){function e(e,t,n){var a=Math.floor(Math.random()*t)+e;return(n||"undefined"==typeof n)&&(a*=1==Math.floor(2*Math.random())?1:-1),a}function t(){var e=new THREE.Object3D;this.count=0;var t=this;return f.load(d.urls.tex.butterfly.left,function(n){var a=new THREE.MeshPhongMaterial({color:16777215,map:n,transparent:!0,depthTest:!0,depthWrite:!0,alphaTest:.8,side:THREE.DoubleSide}),o=new THREE.PlaneGeometry(1,1,1,1);o.vertices.forEach(function(e,t){e.x-=.5});var r=new THREE.Mesh(o,a);r.update=function(e){this.rotation.y=Math.sin(.025*e)},e.add(r),t.count++}),f.load(d.urls.tex.butterfly.right,function(n){var a=new THREE.MeshPhongMaterial({color:16777215,map:n,transparent:!0,depthTest:!0,depthWrite:!0,alphaTest:.9,side:THREE.DoubleSide}),o=new THREE.PlaneGeometry(1,1,1,1);o.vertices.forEach(function(e,t){e.x+=.5});var r=new THREE.Mesh(o,a);r.update=function(e){this.rotation.y=Math.sin(-.025*e)},e.add(r),t.count++}),e.castShadow=!0,e.rotation.x=-90*Math.PI/180,e.rotation.z=90*Math.PI/180,e.update=function(e){this.position.x=20*Math.sin(2e-4*e),this.position.z=20*Math.cos(-2e-4*e),this.position.y=10+5*Math.sin(-2e-4*e),this.rotation.z=-(2*Math.PI/20*360/e*-2e-4)*Math.PI/180,this.children.forEach(function(t,n){t.update(e)})},e}function n(e){v.length>0&&v.forEach(function(t,n){t.update(e)}),null!=d.mod.schaukel&&d.mod.schaukel.update(e),null!=d.mod.man&&d.mod.man.update(e),null!=d.mod.sun&&d.mod.sun.update(e);var t=.75*s.getDelta();THREE.AnimationHandler.update(t),void 0!==M&&M.update()}var a=16777215,o=window.innerHeight,r=window.innerWidth,s=new THREE.Clock,i=0,d={textures:{tree:null,gras:null,stones:null},mod:{schaukel:null,gras:null,sun:null,man:null,groundPlane:null},urls:{tex:{clouds:"assets/textures/clouds.png",sun:"assets/textures/sun.png",schaukel:"assets/textures/schaukel.jpg",stones:"assets/textures/stones.jpg",man:"assets/textures/man.jpg",tree:"assets/textures/tree.jpg",gras:"assets/textures/gras.jpg",butterfly:{left:"assets/textures/butterfly_left.png",right:"assets/textures/butterfly_right.png"}},model:{man:"assets/json/man.json",stones:"assets/json/stones.json",tree:"assets/json/tree.json"}}},l={x:0,y:0,z:0},u=new THREE.Scene,E=new THREE.Scene;u.fog=new THREE.Fog(15841862,1,1e4);var m=new THREE.PerspectiveCamera(65,r/o,.1,1e3),c=new THREE.PerspectiveCamera(65,r/o,.1,1e3);m.position.set(-16,6.8,-19.85),u.add(m),E.add(c);var h=new THREE.WebGLRenderer({alpha:!0,antialias:!0,transparent:!0}),p=new THREE.WebGLRenderer({alpha:!0,antialias:!0});h.setSize(r,o),p.setSize(r,o),h.domElement.className+="renderer",p.domElement.className+="sunRenderer",h.shadowMap.enabled=!0,h.shadowMap.type=THREE.PCFSoftShadowMap,document.body.appendChild(p.domElement),document.body.appendChild(h.domElement);var w=new THREE.EffectComposer(h);w.addPass(new THREE.RenderPass(u,m));var g=new THREE.ShaderPass({uniforms:{tDiffuse:{type:"t",value:0,texture:null},uScreenWidth:{type:"f",value:window.innerWidth},uScreenHeight:{type:"f",value:window.innerHeight}},vertexShader:document.getElementById("outline-vertex").textContent,fragmentShader:document.getElementById("outline-frag").textContent});g.renderToScreen=!0,w.addPass(g),window.onresize=function(){o=window.innerHeight,r=window.innerWidth,m.aspect=r/o,m.updateProjectionMatrix(),h.setSize(r,o),p.setSize(r,o)},controls=new THREE.OrbitControls(m),controls.target=new THREE.Vector3(-8,7.5,-1.5),controls.damping=.2,controls.maxPolarAngle=110*Math.PI/180,controls.minDistance=20,controls.maxDistance=30,controls.update();var T=new THREE.AmbientLight(10066329,1);u.add(T);var H=new THREE.SpotLight(16764782);H.position.set(0,100,150),H.intensity=2,H.castShadow=!0,H.shadowMapWidth=1024,H.shadowMapHeight=1024,u.add(H);var R=new THREE.SpotLight(11785693,.5);R.position.z=-200,u.add(R);var x=new THREE.JSONLoader,f=new THREE.TextureLoader;f.load(d.urls.tex.tree,function(e){d.textures.tree[0].color=new THREE.Color(16777215),d.textures.tree[0].map=e,d.textures.tree[0].bumpMap=e,d.textures.tree[0].side=THREE.DoubleSide,d.textures.tree[0].needsUpdate=!0}),x.load(d.urls.model.tree,function(e,t){t[0].side=THREE.DoubleSide,d.textures.tree=t;var n=new THREE.Mesh(e,new THREE.MeshFaceMaterial(d.textures.tree));n.castShadow=!0,n.receiveShadow=!0,u.add(n)});var v=[];v.push(t()),v.forEach(function(e,t){u.add(e)}),f.load(d.urls.tex.stones,function(t){d.textures.stones=t,x.load(d.urls.model.stones,function(t,n){var a=new THREE.Mesh(t,new THREE.MeshFaceMaterial(n));console.log(d.textures.stones,n,a),a.material.materials[0].color=new THREE.Color(16777215),a.material.materials[0].map=d.textures.stones,a.material.materials[0].bumpMap=d.textures.stones,a.material.materials[0].side=THREE.DoubleSide,a.material.materials[0].needsUpdate=!0;for(var o=new THREE.Group,r=0,s=0;s<d.mod.groundPlane.geometry.vertices.length;s++)if(s%8==0&&d.mod.groundPlane.geometry.vertices[s].z>1){o.children[r]=a.clone();var i=e(.28,.5,!1);o.children[r].scale.set(i,i,i),o.children[r].position.x=d.mod.groundPlane.geometry.vertices[s].x+e(0,5,!1),o.children[r].position.y=1.2-d.mod.groundPlane.geometry.vertices[s].z,o.children[r].position.z=d.mod.groundPlane.geometry.vertices[s].y+e(0,2,!1),o.children[r].rotation.y=e(0,360,!1),r++}u.add(o)})});var M,y;f.load(d.urls.tex.schaukel,function(e){d.textures.schaukel=e,f.load(d.urls.tex.man,function(e){d.textures.man=e,x.load(d.urls.model.man,function(e,t){console.log(t),t[0].skinning=!0,t[0].map=d.textures.schaukel,t[0].shading=THREE.FlatShading,t[0].color=new THREE.Color(16777215),t[1].specular=new THREE.Color(3355443),t[1].skinning=!0,t[1].map=d.textures.man,t[1].shading=THREE.FlatShading,t[1].color=new THREE.Color(16777215),t[1].specular=new THREE.Color(3355443),d.mod.man=new THREE.SkinnedMesh(e,new THREE.MeshFaceMaterial(t)),console.log(d.mod.man.geometry,d.mod.man),d.mod.man.position.set(-9.5,12.65,-.15),d.mod.man.castShadow=!0,d.mod.man.update=function(e){this.rotation.x=.25*Math.sin(.002*e)},y=new THREE.Animation(d.mod.man,e.animations[1]),y.interpolationType=THREE.AnimationHandler.CATMULLROM_FORWARD,y.play(),y.timeScale=1,M=new THREE.SkeletonHelper(d.mod.man),M.material.linewidth=1,M.visible=!1,u.add(M),u.add(d.mod.man)})})}),f.load(d.urls.tex.sun,function(e){var t=new THREE.PlaneGeometry(100,100);d.mod.sun=new THREE.Mesh(t,new THREE.MeshBasicMaterial({map:e,color:new THREE.Color(16777215),transparent:!0,transparent:!0,depthTest:!0,depthWrite:!0,alphaTest:.05,fog:!1,side:THREE.DoubleSide})),d.mod.sun.position.z+=200,d.mod.sun.position.y+=10,d.mod.sun.update=function(e){this.rotation.copy(m.rotation)},E.add(d.mod.sun)}),f.load(d.urls.tex.clouds,function(t){for(var n=new THREE.PointsMaterial({color:new THREE.Color(16777215),size:150,transparent:!0,depthTest:!0,depthWrite:!0,alphaTest:.8,map:t,fog:!1}),a=new THREE.Geometry,o=0;50>o;o++){var r=e(50,200,!0),s=e(50,200,!1),i=e(50,200,!0);a.vertices.push(new THREE.Vector3(r,s,i))}var d=new THREE.Points(a,n);E.add(d)}),f.load(d.urls.tex.gras,function(t){var n=new THREE.PlaneGeometry(100,100,64,64);d.textures.gras=t,d.textures.gras.wrapS=d.textures.gras.wrapT=THREE.Repeat,d.textures.gras.repeat=new THREE.Vector2(10,10);var a=new THREE.MeshPhongMaterial({color:5007649,side:THREE.DoubleSide,shading:THREE.FlatShading,shininess:1,specular:new THREE.Color(10976881),vertexColors:THREE.VertexColors,map:t,bumpMap:d.textures.gras,bumpScale:.2}),o=[];d.mod.groundPlane=new THREE.Mesh(n,a),d.mod.groundPlane.rotation.x=90*Math.PI/180,d.mod.groundPlane.geometry.vertices.forEach(function(t,n){t.z+=.5-(Math.random()*(.04*(t.x+t.y))-e(0,1.05,!1))+.05*(Math.abs(t.x)+Math.abs(t.y)),o.push(new THREE.Color(0)),(t.y>49||t.y<-49||t.x<-49||t.x>49)&&(t.z=20)}),d.mod.groundPlane.position.y+=1,d.mod.groundPlane.geometry.colors=o,d.mod.groundPlane.geometry.colorsNeedUpdate=!0,d.mod.groundPlane.receiveShadow=!0,d.mod.groundPlane.geometry.verticesNeedsUpdate=!0,u.add(d.mod.groundPlane)});var P=function(e){n(e),controls.update(),h.clear(),w.render(),c.position.copy(m.position),c.rotation.copy(m.rotation),p.render(E,c),requestAnimationFrame(P)};P(i)}();