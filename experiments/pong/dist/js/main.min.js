function hashCode(e){return e.split("").reduce(function(e,a){return e=(e<<5)-e+a.charCodeAt(0),e&e},0)}function isInRange(e,a,r){return e>=a&&r>=e}function createElement(e){var a=null,r=document.createElement(e.type);if(r.classList.add("element-"+e.type),"inputType"in e){a=document.createElement("div"),a.classList.add("element-holder-input"),r.type=e.inputType,r.name=e.classer,r.checked=e.checked,r.id=e.type+"-"+hashCode(e.content),a.appendChild(r);var t=document.createElement("label");t.innerHTML=e.content,t.setAttribute("for",r.id),a.appendChild(t)}else"content"in e&&(r.innerHTML=e.content);return"classer"in e&&r.classList.add(e.classer),"cb"in e&&r.addEventListener(e.cbType,function(a){e.cb(a)}),null!=a?a:r}function createSource(e){var a=audioContext.createBufferSource();return a.buffer=e,a.connect(audioContext.destination),{source:a}}function playSound(e,a){if(!gameOptions.mute){var r=createSource(e);return r.source.loop=a,r.playing=!0,r.source.start?r.source.start():r.source.noteOn(0),r}}function initPostprocessing(e){var a=new THREE.RenderPass(scene,e),r=new THREE.BokehPass(scene,e,{focus:1,aperture:.15,maxblur:2,width:canvas_width,height:canvas_height});r.renderToScreen=!0;var t=new THREE.EffectComposer(renderer),o=new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1,.05,.25),n=new THREE.MeshDepthMaterial;n.depthPacking=THREE.RGBADepthPacking,n.blending=THREE.NoBlending;var s={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter};depthRenderTarget=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,s);var l=new THREE.ShaderPass(THREE.SSAOShader);l.renderToScreen=!1,l.uniforms.tDepth.value=depthRenderTarget.texture,l.uniforms.size.value.set(window.innerWidth,window.innerHeight),l.uniforms.cameraNear.value=e.near,l.uniforms.cameraFar.value=e.far,l.uniforms.onlyAO.value=1==postprocessing.renderMode,l.uniforms.aoClamp.value=.5,l.uniforms.lumInfluence.value=.05,t.addPass(a),t.addPass(l),t.addPass(o),t.addPass(r),postprocessing.composer=t,postprocessing.bokeh=r}function wrapTexture(e,a){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(a,a)}function init(){function e(e,a){a[0]=new THREE.MeshStandardMaterial({color:11184810,map:concrete_tex,roughness:.7,metalness:.2,aoMapIntensity:2,bumpScale:.05,shading:THREE.FlatShading,aoMap:concrete_tex_aoMap,metalnessMap:concrete_tex_metalness,bumpMap:concrete_tex_norm}),floor=new THREE.Mesh(e,new THREE.MeshFaceMaterial(a)),floor.receiveShadow=!0,floor.castShadow=!0,scene.add(floor)}function a(e,a){a.forEach(function(e,a){console.log(e.name,a)}),a[0]=new THREE.MeshStandardMaterial({color:13421772,map:rohr_albedo,bumpScale:.1,roughness:.8,metalness:.7,metalnessMap:rohr_metallic,roughnessMap:rohr_roughness,bumpMap:rohr_normal}),a[1]=new THREE.MeshStandardMaterial({color:16777215,emissive:6710886}),a[2]=new THREE.MeshStandardMaterial({color:3355443});var r=new THREE.Mesh(e,new THREE.MeshFaceMaterial(a));r.castShadow=!0,scene.add(r)}function r(e,a){var r=new THREE.Mesh(e,new THREE.MeshBasicMaterial({map:texture,transparent:!0,alphaTest:.005,side:THREE.DoubleSide})),t={texture:{value:texture}},o=document.getElementById("vertexShaderDepth").textContent,n=document.getElementById("fragmentShaderDepth").textContent;r.customDepthMaterial=new THREE.ShaderMaterial({uniforms:t,vertexShader:o,fragmentShader:n,side:THREE.DoubleSide}),r.castShadow=!0,scene.add(r)}scene=new THREE.Scene;var t=new THREE.PerspectiveCamera(55,canvas_width/canvas_height,.1,1e3);t.position.set(10,4,-3),scene.add(t),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),renderer.setSize(canvas_width,canvas_height),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.setClearColor(main_color,1),renderer.domElement.classList.add("pongGame"),document.body.appendChild(renderer.domElement),window.onresize=function(){canvas_height=window.innerHeight,canvas_width=window.innerWidth,t.aspect=canvas_width/canvas_height,t.updateProjectionMatrix(),renderer.setSize(canvas_width,canvas_height)},initPostprocessing(t),controls=new THREE.OrbitControls(t),controls.target.set(0,4,-3),controls.damping=0,controls.noKeys=!0,controls.minPolarAngle=80*Math.PI/180,controls.maxPolarAngle=99*Math.PI/180,controls.minAzimuthAngle=60*Math.PI/180,controls.maxAzimuthAngle=120*Math.PI/180,controls.minDistance=10,controls.maxDistance=13;var o=new THREE.AmbientLight(10066329);scene.add(o);var n=100,s=new THREE.SpotLight(3846139);s.position.set(3,10,-5),s.intensity=.2,s.angle=Math.PI/3,s.penumbra=.9,s.castShadow=!0,s.shadow.mapSize.width=512,s.shadow.mapSize.height=512,s.shadow.camera.near=1,s.shadow.camera.far=30,s.shadow.camera.fov=t.fov,s.shadow.camera.left=-n,s.shadow.camera.right=n,s.shadow.camera.top=n,s.shadow.camera.bottom=-n,scene.add(s);var l=new THREE.SpotLight(16379852);l.position.set(-3.5,4,2.5),l.target.position.set(.5,0,2.5),l.target.updateMatrixWorld(),l.intensity=.4,l.angle=Math.PI/4,l.penumbra=.9,l.castShadow=!0,l.shadow.mapSize.width=512,l.shadow.mapSize.height=512,l.shadow.camera.near=1,l.shadow.camera.far=50,l.shadow.camera.fov=t.fov,l.shadow.camera.left=-n,l.shadow.camera.right=n,l.shadow.camera.top=n,l.shadow.camera.bottom=-n,scene.add(l);var i=new THREE.SpotLight(16379852);i.position.set(-3.5,4,-9.25),i.target.position.set(.5,0,-9.25),i.target.updateMatrixWorld(),i.intensity=.4,i.angle=Math.PI/4,i.penumbra=.9,i.castShadow=!0,i.shadow.mapSize.width=512,i.shadow.mapSize.height=512,i.shadow.camera.near=1,i.shadow.camera.far=50,i.shadow.camera.fov=t.fov,i.shadow.camera.left=-n,i.shadow.camera.right=n,i.shadow.camera.top=n,i.shadow.camera.bottom=-n,scene.add(i),wrapTexture(concrete_tex,8),wrapTexture(concrete_tex_norm,8),wrapTexture(concrete_tex_metalness,8),wrapTexture(concrete_tex_aoMap,8);wrapTexture(rohr_albedo,10),wrapTexture(rohr_metallic,10),wrapTexture(rohr_roughness,10),wrapTexture(rohr_normal,40),texture=new THREE.Texture(canvas),e(assets.floor.geometry,assets.floor.material),a(assets.rohr.geometry,assets.rohr.material),r(assets.screen.geometry,assets.screen.material),render(time)}function Explosion(e,a){this.count=50,this.isActive=!0,this.createPoints=function(r){for(var t=[],o=0;o<this.count;o++)t.push({pos:{x:e.x,y:e.y},vel:{x:-1.5+3*Math.random(),y:a+3*Math.random()},lifetime:0,maxLifetime:20+50*Math.random()});return t};var r=this.createPoints();this.update=function(e){var a=0;c.fillStyle="#ff9800",r.forEach(function(r,t){r.pos.x+=r.vel.x,r.pos.y+=r.vel.y,r.lifetime<r.maxLifetime?(e.fillRect(r.pos.x,r.pos.y,2,2),r.lifetime++):a++}),c.fillStyle="#2ca3ff",a==this.count&&(this.isActive=!1)}}function Bounce(e,a){this.count=5,this.isActive=!0,this.createRadius=function(a){for(var r=[],t=0;t<this.count;t++)r.push({pos:{x:e.x,y:e.y},rad:1,radVel:50*Math.random(),lifetime:0,maxLifetime:20+10*Math.random()});return r};var r=this.createRadius();this.update=function(e){var t=0;c.setLineDash([0,0]);var o={};a>0?(o.start=320,o.end=40):(o.start=130,o.end=230),r.forEach(function(r,o){r.rad+=.01*r.radVel,r.pos.x+=.25*a,r.lifetime<r.maxLifetime?(e.beginPath(),e.arc(r.pos.x,r.pos.y,r.rad,0,2*Math.PI,!1),e.lineWidth=1,e.stroke(),r.lifetime++):t++}),c.strokeStyle="#2ca3ff",c.setLineDash([15,15]),t==this.count&&(this.isActive=!1)}}function respawn(){ball.dir.x>0&&(player.a.points+=1,2==gameOptions.playerCount?playSound(assets.sounds.juchu,!1):playSound(assets.sounds.loose,!1)),ball.dir.x<0&&(player.b.points+=1,2==gameOptions.playerCount?playSound(assets.sounds.juchu,!1):playSound(assets.sounds.loose,!1)),ball.pos.x=screenSize.x/2,ball.pos.y=screenSize.y/2+Math.random()*screenSize.y/4,ball.vel.y=.5*Math.random(),(player.a.points>=10||player.b.points>=10)&&(gameOptions.playing=!0)}function handlePlayer(){keyCode.player1.left&&(player.b.vel.x-=.25),keyCode.player1.right&&(player.b.vel.x+=.25),keyCode.player1.up&&(player.b.vel.y-=1),keyCode.player1.down&&(player.b.vel.y+=1),keyCode.player2.left&&(player.a.vel.x-=.25),keyCode.player2.right&&(player.a.vel.x+=.25),keyCode.player2.up&&(player.a.vel.y-=1),keyCode.player2.down&&(player.a.vel.y+=1)}function animation(e){texture.needsUpdate=!0,player.a.vel.x*=.9,player.b.vel.x*=.9,player.a.bounce.multiplier*=.99,player.b.bounce.multiplier*=.99,player.a.vel.y*=.9,player.b.vel.y*=.9,c.update(e)}var canvas=document.createElement("canvas");canvas.width=1024,canvas.height=1024,canvas.classList.add("pong");var c=canvas.getContext("2d"),screenSize={x:1024,y:468},player={a:{points:0,height:100,vel:{x:0,y:0},bounce:{x:0,y:0,multiplier:0},size:{x:5,y:100},pos:{x:10,y:screenSize.y/2}},b:{points:0,height:100,vel:{x:0,y:0},bounce:{x:0,y:0,multiplier:0},size:{x:5,y:100},pos:{x:screenSize.x-15,y:screenSize.y/2}}},ball={size:{x:10,y:10},pos:{x:screenSize.x/2,y:screenSize.y/2},spin:{x:0,y:0},vel:{x:1,y:1},dir:{x:1,y:1},speed:{x:5,y:5}},main_color=0,time=0,canvas_height=window.innerHeight,canvas_width=window.innerWidth,floor,scene,renderer,controls,texture,playBox,rePlayBox,manager=new THREE.LoadingManager;manager.onProgress=function(e,a,r){console.log(e,a,r),a==r&&(window.scrollTo(0,1),init())};var loader=new THREE.JSONLoader(manager),textureLoader=new THREE.TextureLoader(manager),postprocessing={},gameOptions={playing:!1,audio:!1,playerCount:1,playSelect:!1,menuIndex:0,menuMax:2,alreadyPlayed:!1,mute:!1},menu={title:"PONG",playTitle:"PLAY"},holder=createElement({type:"div",classer:"holder"});holder.classList.add("start");var menuHolder=createElement({type:"div",classer:"menu-holder"});holder.appendChild(createElement({type:"h1",classer:"title",content:menu.title}));var playerForm=createElement({type:"form",classer:"choose-playerCount"});menuHolder.appendChild(playerForm),playerForm.appendChild(createElement({type:"input",inputType:"radio",classer:"button-player",content:"1 Player",checked:!0,cbType:"change",cb:function(){gameOptions.playerCount=1,console.log(gameOptions.playerCount)}})),playerForm.appendChild(createElement({type:"input",inputType:"radio",classer:"button-player",content:"2 Player",checked:!1,cbType:"change",cb:function(){gameOptions.playerCount=2,console.log(gameOptions.playerCount)}})),menuHolder.appendChild(createElement({type:"button",classer:"button-mute",cbType:"click",content:"mute",cb:function(e){gameOptions.mute=!gameOptions.mute,e.target.classList.toggle("selected")}})),menuHolder.appendChild(createElement({type:"button",classer:"button-restart",cbType:"click",content:"Restart",cb:function(e){respawn(),player.a.points=0,player.b.points=0,holder.classList.add("inGame"),gameOptions.playing=!0}})),menuHolder.appendChild(createElement({type:"button",classer:"button-play",cbType:"click",content:"Play",cb:function(e){holder.classList.add("inGame"),holder.classList.remove("start"),holder.classList.add("playGame"),gameOptions.playing=!0}})),menuHolder.appendChild(createElement({type:"button",classer:"button-continue",cbType:"click",content:"continue",cb:function(e){holder.classList.add("inGame"),gameOptions.playing=!0}})),holder.appendChild(menuHolder),document.body.appendChild(holder);var concrete_tex=textureLoader.load("assets/textures/concrete.jpg"),concrete_tex_norm=textureLoader.load("assets/textures/concrete_NRM.jpg"),concrete_tex_aoMap=textureLoader.load("assets/textures/concrete_OCC.jpg"),concrete_tex_metalness=textureLoader.load("assets/textures/concrete_SPEC.jpg"),rohr_albedo=textureLoader.load("assets/textures/rohr_albedo.jpg"),rohr_metallic=textureLoader.load("assets/textures/rohr_metallic.jpg"),rohr_roughness=textureLoader.load("assets/textures/rohr_roughness.jpg"),rohr_normal=textureLoader.load("assets/textures/rohr_normal.jpg"),assets={floor:{},rohr:{},screen:{},sounds:{},menuTexture:{keyboard_arrow:new Image,keyboard_wasd:new Image}};assets.menuTexture.keyboard_arrow.src="assets/textures/keyboard_arrow.png",assets.menuTexture.keyboard_wasd.src="assets/textures/keyboard_wasd.png",loader.load("assets/json/floor.json",function(e,a){assets.floor.geometry=e,assets.floor.material=a}),loader.load("assets/json/rohr.json",function(e,a){assets.rohr.geometry=e,assets.rohr.material=a}),loader.load("assets/json/screen.json",function(e,a){assets.screen.geometry=e,assets.screen.material=a});var bufferLoader;window.AudioContext=window.AudioContext||window.webkitAudioContext;var audioContext=new AudioContext,bufferLoader=new AudioBufferLoader(audioContext);bufferLoader.loadBuffer("dip","assets/sounds/blub.mp3",function(e){assets.sounds.dip=e}),bufferLoader.loadBuffer("blub","assets/sounds/dip3.mp3",function(e){assets.sounds.blub=e}),bufferLoader.loadBuffer("blub","assets/sounds/loose.mp3",function(e){assets.sounds.loose=e}),bufferLoader.loadBuffer("juchu","assets/sounds/juchu.mp3",function(e){assets.sounds.juchu=e});var explosions=[],bounces=[];c.fillStyle="#2ca3ff",c.strokeStyle="#2ca3ff",c.font="60px VT323",c.update=function(e){if(this.clearRect(0,0,1024,1024),c.fillText(player.a.points,screenSize.x/4,50),c.fillText(player.b.points,screenSize.x/4*3,50),c.setLineDash([15,15]),c.beginPath(),c.lineWidth=2,c.moveTo(screenSize.x/2,0),c.lineTo(screenSize.x/2,screenSize.y),c.stroke(),gameOptions.playing&&(1==gameOptions.playerCount&&(player.a.pos.y<ball.pos.y?(player.a.pos.y+=4-3*Math.random(),player.a.vel.y+=.75):(player.a.pos.y-=4-3*Math.random(),player.a.vel.y-=.75)),player.a.pos.y+=player.a.vel.y,player.b.pos.y+=player.b.vel.y,player.a.pos.x+=player.a.vel.x,player.b.pos.x+=player.b.vel.x,ball.pos.x+=ball.vel.x*ball.speed.x*ball.dir.x,ball.pos.y+=ball.vel.y*ball.speed.y*ball.dir.y),player.a.pos.x=player.a.pos.x<=0?0:player.a.pos.x,player.a.pos.x=player.a.pos.x>=screenSize.x/2?screenSize.x/2:player.a.pos.x,player.b.pos.x=player.b.pos.x<=screenSize.x/2+player.b.size.x?screenSize.x/2+player.b.size.x:player.b.pos.x,player.b.pos.x=player.b.pos.x>=screenSize.x-player.b.size.x?screenSize.x-player.b.size.x:player.b.pos.x,player.a.pos.y=player.a.pos.y<=player.a.height/2?player.a.height/2:player.a.pos.y,player.a.pos.y=player.a.pos.y>=screenSize.y-player.a.height/2?screenSize.y-player.a.height/2:player.a.pos.y,player.b.pos.y=player.b.pos.y<=player.b.height/2?player.b.height/2:player.b.pos.y,player.b.pos.y=player.b.pos.y>=screenSize.y-player.b.height/2?screenSize.y-player.b.height/2:player.b.pos.y,player.a.bounce.x=Math.sin(.05*e)*player.a.bounce.multiplier,player.b.bounce.x=Math.sin(.05*e)*player.b.bounce.multiplier,c.setLineDash([]),c.lineWidth=5,c.beginPath(),c.moveTo(player.a.pos.x,player.a.pos.y-player.a.height/2),c.bezierCurveTo(player.a.pos.x+player.a.bounce.x,player.a.pos.y-player.a.height/4,player.a.pos.x+player.a.bounce.x,player.a.pos.y+player.a.height/4,player.a.pos.x,player.a.pos.y+player.a.height/2),c.stroke(),c.setLineDash([]),c.lineWidth=5,c.beginPath(),c.moveTo(player.b.pos.x,player.b.pos.y-player.b.height/2),c.bezierCurveTo(player.b.pos.x+player.b.bounce.x,player.b.pos.y-player.b.height/4,player.b.pos.x+player.b.bounce.x,player.b.pos.y+player.b.height/4,player.b.pos.x,player.b.pos.y+player.b.height/2),c.stroke(),isInRange(ball.pos.y,player.b.pos.y-player.b.size.y/2,player.b.pos.y+player.b.size.y/2)&&isInRange(ball.pos.x+ball.size.x/2,player.b.pos.x,player.b.pos.x+player.b.size.x)&&(playSound(assets.sounds.blub,!1),player.b.bounce.multiplier=5,ball.dir.x*=-1,bounces.push(new Bounce({x:ball.pos.x,y:ball.pos.y},-1))),isInRange(ball.pos.y,player.a.pos.y-player.a.size.y/2,player.a.pos.y+player.a.size.y/2)&&isInRange(ball.pos.x-ball.size.x/2,player.a.pos.x,player.a.pos.x+player.a.size.x)&&(playSound(assets.sounds.blub,!1),player.a.bounce.multiplier=5,ball.dir.x*=-1,ball.vel.y-=.075*player.a.vel.y,bounces.push(new Bounce({x:ball.pos.x,y:ball.pos.y},1))),(ball.pos.x<ball.size.x/2||ball.pos.x>screenSize.x-ball.size.x/2)&&respawn(),ball.pos.y>=screenSize.y||ball.pos.y<=0){ball.dir.y*=-1;var a=null;a=ball.pos.y>screenSize.y/2?-1:1,playSound(assets.sounds.dip,!1),explosions.push(new Explosion({x:ball.pos.x,y:ball.pos.y},a))}c.fillRect(ball.pos.x-ball.size.x/2,ball.pos.y-ball.size.y/2,10,10),explosions.forEach(function(e,a){e.isActive?e.update(c):explosions.splice(a,1)}),bounces.forEach(function(e,a){e.isActive?e.update(c):bounces.splice(a,1)})},document.body.appendChild(canvas);var keyCode={player1:{up:!1,down:!1,left:!1,right:!1},player2:{up:!1,down:!1,left:!1,right:!1}};window.addEventListener("keydown",function(e){console.log(e.keyCode),9!=e.keyCode||gameOptions.playing||(gameOptions.menuIndex=gameOptions.menuIndex<gameOptions.menuMax?0:gameOptions.menuIndex++),37!=e.keyCode||keyCode.player1.left||(keyCode.player1.left=!0),39!=e.keyCode||keyCode.player1.right||(keyCode.player1.right=!0),38!=e.keyCode||keyCode.player1.up||(player.b.vel.y=1,keyCode.player1.up=!0),40!=e.keyCode||keyCode.player1.down||(player.b.vel.y=1,keyCode.player1.down=!0),65!=e.keyCode||keyCode.player2.left||(keyCode.player2.left=!0),68!=e.keyCode||keyCode.player2.right||(keyCode.player2.right=!0),87!=e.keyCode||keyCode.player2.up||(player.a.vel.y=1,keyCode.player2.up=!0),83!=e.keyCode||keyCode.player2.down||(player.a.vel.y=1,keyCode.player2.down=!0),32!=e.keyCode&&27!=e.keyCode||gameOptions.playing&&(gameOptions.playing=!gameOptions.playing,holder.classList.toggle("inGame"))}),window.addEventListener("keyup",function(e){controls.enabled=!0,37==e.keyCode&&(keyCode.player1.left=!1),39==e.keyCode&&(keyCode.player1.right=!1),38==e.keyCode&&(keyCode.player1.up=!1),40==e.keyCode&&(keyCode.player1.down=!1),65==e.keyCode&&(keyCode.player2.left=!1),68==e.keyCode&&(keyCode.player2.right=!1),87==e.keyCode&&(keyCode.player2.up=!1),83==e.keyCode&&(keyCode.player2.down=!1)});var render=function(e){requestAnimationFrame(render),animation(e),controls.update(),handlePlayer(),postprocessing.composer.render(.1)};