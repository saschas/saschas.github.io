function VRPointer(e){this.midPoint=new THREE.Vector2(0,0),this.raycaster=new THREE.Raycaster,this.camera=e.camera,this.scene=e.scene,this.distanceFromCamera=e.distanceFromCamera?e.distanceFromCamera:50,this.color=e.color?e.color:"#ffffff",this.opacity=e.opacity?e.opacity:.75,this.size=e.size?e.size:1,this.duration=e.duration?e.duration:100,this.intersects=[],this.activeElements=e.activeElements?e.activeElements:[],this.time=0,this.strokeWidth=e.strokeWidth?e.strokeWidth:2;var t=256,n=t-10*this.strokeWidth,a=t-10*this.strokeWidth/2,o=t/2,s=document.createElement("canvas");s.width=t,s.height=t,s.style.position="absolute",s.style.display="none",document.body.appendChild(s),this.map=new THREE.Texture(s),this.map.needsUpdate=!0;var r=s.getContext("2d"),i=new THREE.Mesh(new THREE.PlaneBufferGeometry(this.size,this.size,2,2),new THREE.MeshBasicMaterial({transparent:!0,map:this.map,depthWrite:!1,depthTest:!1}));i.name="referencePoint",i.lookAt(this.camera),i.position.z=-this.distanceFromCamera,this.camera.add(i),this.draw=function(e,s){var i=o-10*this.strokeWidth/2;r.clearRect(0,0,t,t),r.save(),r.globalAlpha=1,r.beginPath(),r.arc(o,o,i,0,2*Math.PI,!1),r.lineWidth=10*this.strokeWidth,r.strokeStyle=this.color,r.stroke(),r.clip(),r.fillStyle=this.color,r.globalAlpha=this.opacity,r.fillRect(10*this.strokeWidth/2,a-Math.floor(e*n/s),n,Math.floor(e*n/s)),r.restore(),this.map.needsUpdate=!0},this.draw(r);for(var l=0;l<this.activeElements.length;l++)this.activeElements[l].time=0,this.activeElements[l].duration=this.activeElements[l].duration?this.activeElements[l].duration:this.duration,this.activeElements[l].hoverElements=null;this.checkCollision=function(e){this.raycaster.setFromCamera(this.midPoint,this.camera),this.intersects=[],this.intersects=this.raycaster.intersectObjects(e.elements);var t;if(this.intersects.length>0){for(var n=0;n<this.intersects.length;n++)t=this.intersects[n].point,"function"==typeof e.hover&&e.hover({element:this.intersects[n].object,point:t,distance:this.intersects[n].distance}),e.time===e.duration&&"function"==typeof e.click&&e.click({element:this.intersects[n].object,point:t,distance:this.intersects[n].distance}),e.time++,this.draw(e.time,e.duration);e.hoverElements=this.intersects}else e.time=0,null!==e.hoverElements&&(this.draw(e.time),"function"==typeof e.out&&e.hoverElements.forEach(function(t){e.out({element:t.object,point:t.point,distance:t.distance})}),e.hoverElements=null)},this.update=function(){for(var e=0;e<this.activeElements.length;e++)this.checkCollision(this.activeElements[e])}}function pickRandomProperty(e,t){var n,a=0;for(var o in t)Math.random()<1/++a&&(n=t[o]);return n}function getRandomStyleColor(e){var t=Object.keys(e).length-1,n=Math.random()*t;return pickRandomProperty(n,e)}function randNum(e,t,n){var a=Math.floor(Math.random()*t)+e;return(n||"undefined"==typeof n)&&(a*=1==Math.floor(2*Math.random())?1:-1),a}function createVREnabler(){var e=document.createElement("button");return e.className="switch_to_vr",e.addEventListener("click",enableVR),e.innerHTML="Enable VR",document.body.appendChild(e),e}function createVRDisabler(){var e=document.createElement("button");return e.className="switch_to_orbit hide",e.addEventListener("click",disableVR),e.innerHTML="Disable VR",document.body.appendChild(e),e}function enableFullScreenMode(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function disableFullScreenMode(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function enableVR(){console.log("vr enabled"),controls.orbit.enabled=!1,controls.vr.connect(),controls.type="vr",controls.enableButton.classList.add("hide"),controls.disableButton.classList.remove("hide"),Adjust.VRPointer({camera:camera,scene:scene,strokeWidth:4,midPoint:new THREE.Vector2(0,0),distanceFromCamera:55,color:"#ffffff",opacity:.8,size:2,duration:100,activeElements:[{elements:naviObjects,hover:function(e){over(e.element)},out:function(e){out(e.element)},click:function(e){activeState(e.element)}}]}),enableFullScreenMode(document.documentElement)}function disableVR(){console.log("vr disabled"),controls.orbit.enabled=!0,controls.vr.disconnect(),controls.type="orbit",controls.enableButton.classList.remove("hide"),controls.disableButton.classList.add("hide"),renderer.setSize(canvas_width,canvas_height),Adjust.removeVRPointer(),disableFullScreenMode()}function loadTexture(e,t,n){tLoader.load(n,function(n){assets.slides[t]=n,assets.slides[t]._id=e})}function loadModel(e,t){loader.load(t,function(t){assets.geometry[e]=t})}function loadItems(){for(var e=0;e<slides.length;e++)loadTexture(e,slides[e].name,"dist/textures/slides/"+slides[e].name+".jpg");tLoader.load("dist/textures/arrow.png",function(e){assets.textures.arrow=e}),tLoader.load("dist/textures/eye.png",function(e){assets.textures.eye=e});for(model in models)loadModel(model,base_url+models[model]+".json");return assets}function init(){canvas_height=window.innerHeight,canvas_width=window.innerWidth,scene=new THREE.Scene,scene.fog=new THREE.FogExp2(colorPalette.piup,.01);var e=new THREE.Color(colorPalette.piup);document.body.style.background="#"+e.getHexString(),camera=new THREE.PerspectiveCamera(85,canvas_width/canvas_height,.001,500),camera.position.set(0,18,0),scene.add(camera),renderer=new THREE.WebGLRenderer({alpha:!0,transparent:!0,antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(canvas_width,canvas_height),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.setClearColor(colorPalette.piup,1),renderer.domElement.classList.add("render-element"),document.body.appendChild(renderer.domElement),Adjust.init({camera:camera,scene:scene,renderer:renderer}),ambient=new THREE.AmbientLight(6710886),scene.add(ambient),spotLight=new THREE.SpotLight(16777215),spotLight.position.set(-50,250,100),spotLight.castShadow=!0,spotLight.power=1.2*Math.PI,spotLight.shadow.mapSize.width=1024,spotLight.shadow.mapSize.height=1024,spotLight.shadow.camera.near=2,spotLight.shadow.camera.far=50,spotLight.shadow.camera.fov=55,spotLight.shadow.camera.left=50,spotLight.shadow.camera.right=50,spotLight.shadow.camera.top=50,spotLight.shadow.camera.bottom=50,scene.add(spotLight),controls.orbit=new THREE.OrbitControls(camera),controls.orbit.damping=.2,controls.orbit.target=new THREE.Vector3(0,camera.position.y,-.1),controls.orbit.minDistance=0,controls.orbit.maxDistance=.1,controls.vr=new THREE.DeviceOrientationControls(camera),effect=new THREE.StereoEffect(renderer),effect.focalLength=55,effect.eyeSeparation=2,effect.setSize(canvas_width,canvas_height),floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,64,64),new THREE.MeshPhongMaterial({color:colorPalette.piup,shading:THREE.FlatShading,shininess:1}));for(var t=0;t<floor.geometry.vertices.length;t++)floor.geometry.vertices[t].z+=2*Math.random();floor.geometry.needsUpdate=!0,floor.rotation.x=-90*Math.PI/180,floor.position.y=-2,floor.receiveShadow=!0,floor.castShadow=!0,scene.add(floor),assets.screen=leinwand(assets),assets.eye=eye(assets),window.onresize=function(){canvas_height=window.innerHeight,canvas_width=window.innerWidth,camera.aspect=canvas_width/canvas_height,camera.updateProjectionMatrix(),renderer.setSize(canvas_width,canvas_height),effect.setSize(canvas_width,canvas_height),Adjust.resize()}}function leinwand(e){var t=new THREE.Mesh(e.geometry.leinwand,new THREE.MeshPhongMaterial({color:16777215,side:THREE.DoubleSide,map:e.slides["slide-00"]}));t.castShadow=!0,scene.add(t);var n=new THREE.Mesh(e.geometry.right,new THREE.MeshLambertMaterial({color:16777215,transparent:!0,opacity:0,map:e.textures.arrow}));n.name="right",naviObjects.push(n),scene.add(n);var a=new THREE.Mesh(e.geometry.left,new THREE.MeshLambertMaterial({color:16777215,transparent:!0,opacity:0,map:e.textures.arrow}));return a.name="left",naviObjects.push(a),scene.add(a),Adjust.addActiveObject(n,over,out,activeState,!1),Adjust.addActiveObject(a,over,out,activeState,!1),t}function setSlide(e,t){assets.screen.material.map=t,assets.screen.material.needsUpdate=!0,assets.screen.material.map._id=e}function changeBGColor(e){var t=renderer.getClearColor(),n={r:t.r,g:t.g,b:t.b},a={r:e.r,g:e.g,b:e.b};new TWEEN.Tween(n).to(a,1e3).onUpdate(function(){var e=new THREE.Color(this.r,this.g,this.b);renderer.setClearColor(e),floor.material.color=e,scene.fog.color=e,document.body.style.background="#"+e.getHexString()}).start()}function changeSlide(e){var t=assets.screen.material.map._id;switch(e){case"left":t--,t=-1==t?slides.length-1:t;break;case"right":t++,t=t==slides.length?0:t}var n="slide-";n+=10>t?"0"+t:t,changeBGColor(slides[t].bgColor),setSlide(t,assets.slides[n])}function over(e){e.material.opacity<1&&(e.material.opacity+=.05)}function out(e){e.material.opacity=0}function activeState(e){changeSlide(e.name)}function handleKeys(e){var t=e?e:event,n=null;switch(t.keyCode){case 39:n="right";break;case 37:n="left";break;case 65:n="left";break;case 68:n="right"}null!==n&&changeSlide(n)}function handleClick(e){e?e:event;if(Adjust.vr&&null!==Adjust.activeElements[0].hoverElements){var t=Adjust.activeElements[0].hoverElements[0].object.name;changeSlide(t)}}function eye(e){var t=[],n=new THREE.MeshPhongMaterial({skinning:!0,bumpMap:e.textures.eye,bumpScale:.1,map:e.textures.eye,transparent:!0,side:THREE.DoubleSide,shininess:1,alphaTest:.2}),a=new THREE.SkinnedMesh(e.geometry.eye,n);a.name="eye";for(var o=0;60>o;o++){var s=randNum(.5,3,!1);randNum(.1,.9,!1);t[o]=a.clone(),t[o].position.x=randNum(10,160,!0),t[o].position.y=randNum(30,50,!1),t[o].position.z=-55+randNum(0,160,!0),t[o].scale.set(s,s,s),t[o].updateMatrix(),t[o].matrixAutoUpdate=!1,t[o].update=function(){Adjust.vr?eyefollowPosition(this,camera.children[0]):eyefollowPosition(this,camera)},scene.add(t[o])}return t}function eyefollowPosition(e,t){var n={};"matrixWorld"in t?(n=t.position.clone(),n.z+=t.position.z,n.y+=18,n.setFromMatrixPosition(t.matrixWorld),n.x-=e.position.x,n.y-=e.position.y,n.z-=e.position.z,e.skeleton.bones[0].lookAt(n),e.skeleton.bones[1].lookAt(n),e.skeleton.bones[2].lookAt(n)):n=t.clone()}function animation(e){"vr"!=controls.type?(controls.orbit.update(),renderer.render(scene,camera)):(controls.vr.update(),effect.render(scene,camera));for(var t=0;t<assets.eye.length;t++)assets.eye[t].update()}for(var canvas_height,canvas_width,renderer,floor,scene,controls,camera,effect,ambient,spotLight,loadingIcon=document.getElementById("loadingStatus"),vr_pointer,time=0,assets={geometry:{},textures:{},slides:{}},screenObjects=[],naviObjects=[],colorPalette={piup:new THREE.Color(4275786),blue:new THREE.Color(5795452),gray:new THREE.Color(13881808),brown:new THREE.Color(9271654),cooler:new THREE.Color(11051933),trajan:new THREE.Color(14207160)},base_url="assets/json/",models={eye:"eye",leinwand:"leinwand",right:"slide_right",left:"slide_left"},slides=[],placeHolder="",i=0;40>i;i++)placeHolder=10>i?"0":"",slides.push({name:"slide-"+placeHolder+i,bgColor:getRandomStyleColor(colorPalette)});var manager=new THREE.LoadingManager,loader=new THREE.JSONLoader(manager),tLoader=new THREE.TextureLoader(manager);manager.onProgress=function(e,t,n){var a=100*t/n;loadingIcon.style.width=a+"%"},manager.onLoad=function(){init(),document.body.classList.add("ready"),render(time)};var controls={type:"orbit",orbit:null,vr:null,effect:null,enableButton:createVREnabler(),disableButton:createVRDisabler()};window.addEventListener("keydown",handleKeys),window.addEventListener("mousedown",handleClick);var render=function(e){requestAnimationFrame(render),TWEEN.update(e),Adjust.update(),animation()};loadItems();