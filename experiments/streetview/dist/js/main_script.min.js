function baseObj(e,t,o){return{obj:e,coor:t,rot:o}}function loadJSON(e,t){var o=new XMLHttpRequest;o.overrideMimeType("application/json"),o.open("GET",e,!0),o.onreadystatechange=function(){4==o.readyState&&"200"==o.status&&t(JSON.parse(o.responseText))},o.send(null)}function rotateMesh(e,t){var o=e.info.rot+t;360==o&&(o=0),0>o&&(o=360),e.rotation.y=o*Math.PI/180,e.info.rot=o,console.log("target:",places[e.info.coor]),places[e.info.coor].rot=o,e.updateMatrix(),e.matrixAutoUpdate=!1,infoBox.innerHTML="<span>ID: "+e.info.coor+"</span><span>Type: "+e.info.obj+"</span><span>rotation: "+e.info.rot+"</span>"}function randomRotation(){var e=[0,90,180,270];return e[Math.ceil(Math.random()*(e.length-1))]}function loadTile(e){var t=e;loader.load(base_url+e+".json",function(e,o){o.forEach(function(e,t){e.shading=THREE.FlatShading}),global.models[t]=new THREE.Mesh(e,new THREE.MeshFaceMaterial(o)),global.models[t].name=t})}function createLabel(e,t){var o=document.createElement("div");return o.dataset.label=e,o.classList.add("label"),o.innerHTML=t,o}function createGrid(e,t){for(var o=[],a=0;e>a;a++)for(var n=0;e>n;n++)o.push({x:-(e/2*t)+n*t,z:-(e/2*t)+a*t,empty:!0});return o}function switchElement(e,t){places[e.info.coor]=baseObj(t,e.info.coor,0);var o=global.models[t].clone();o.position.x=gridPositions[e.info.coor].x,o.position.z=gridPositions[e.info.coor].z,gridPositions[e.info.coor].empty=!1,o.name=e.info.coor,o.selected=!1,o.info=e.info,o.rotation.y=e.info.rot*Math.PI/180,o.updateMatrix(),o.matrixAutoUpdate=!1,o.castShadow=!0,o.receiveShadow=!0,scene.add(o);var a=Adjust.objects.indexOf(e);Adjust.objects[a]=o,scene.remove(e),global.selected=null}function createOptions(e){var t=document.createElement("button"),o=document.createElement("span"),a=document.createElement("img");return a.src=base_url_ico+e+".png",t.dataset.type=e,t.classList.add("single_option"),o.innerHTML=e,t.appendChild(o),t.appendChild(a),t.addEventListener("click",function(){null!=global.selected&&switchElement(global.selected,this.dataset.type)}),t}function over(e){null==global.lastMaterial&&(global.lastMaterial=e.material,e.material=new THREE.MeshPhongMaterial({color:11184810,shading:THREE.FlatShading}))}function out(e){e.material=global.lastMaterial,global.lastMaterial=null}function activeState(e){new TWEEN.Tween(controls.target).to({x:e.position.x,z:e.position.z},1e3).start(),global.selected===e?(e.position.y=0,e.updateMatrix(),e.matrixAutoUpdate=!1,e.selected=!1,global.selected=null,infoBox.innerHTML=""):(null!=global.selected&&(global.selected.position.y=0,global.selected.updateMatrix(),global.selected.matrixAutoUpdate=!1,global.selected.selected=!1,infoBox.innerHTML=""),e.selected=!0,global.selected=e,e.position.y=.1,e.updateMatrix(),e.matrixAutoUpdate=!1,infoBox.innerHTML="<span>ID: "+e.info.coor+"</span><span>Type: "+e.info.obj+"</span><span>rotation: "+e.info.rot+"</span>")}function addSingleTile(e){var t=global.models[e.obj].clone();return t.position.x=gridPositions[e.coor].x,t.position.z=gridPositions[e.coor].z,gridPositions[e.coor].empty=!1,t.name=e.coor,t.selected=!1,t.info=e,t.rotation.y=e.rot*Math.PI/180,t.updateMatrix(),t.matrixAutoUpdate=!1,t.castShadow=!0,t.receiveShadow=!0,scene.add(t),Adjust.addActiveObject(t,over,out,activeState,!1),t}function generateCity(){var e=document.createElement("div");e.classList.add("labels");var t=document.createElement("div");t.classList.add("options"),tiles.forEach(function(e,o){t.appendChild(createOptions(e))}),places.forEach(function(t,o){addSingleTile(t),e.appendChild(createLabel(t.coor,t.coor))}),document.body.appendChild(e),infoHolder.appendChild(t),Adjust.addLabel("label")}function render(e){requestAnimationFrame(render),animation(e),controls.update(),renderer.render(scene,camera)}function animation(e){TWEEN.update(e),Adjust.update()}!function(e){e.save=function(t,o){if(!t)return void e.error("Console.save: No data");o||(o="console.json"),"object"==typeof t&&(t=JSON.stringify(t,void 0,4));var a=new Blob([t],{type:"text/json"}),n=document.createEvent("MouseEvents"),r=document.createElement("a");r.download=o,r.href=window.URL.createObjectURL(a),r.dataset.downloadurl=["text/json",r.download,r.href].join(":"),n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n)}}(console);var dimension=10,offset=1,time=0,manager=new THREE.LoadingManager,loader=new THREE.JSONLoader(manager),base_url="assets/json/",base_url_ico="assets/ico/",base_url_scenes="assets/scene/",backHolder=document.getElementById("backgroundHolder"),main_color=0,canvas_width=backHolder.offsetWidth,canvas_height=backHolder.offsetHeight,infoBox=document.getElementById("info"),infoHolder=document.getElementById("infoHolder");infoHolder.addEventListener("mouseover",function(){Adjust.disableMouse=!0}),infoHolder.addEventListener("mouseout",function(){Adjust.disableMouse=!1});var exportButton=document.getElementById("export");exportButton.addEventListener("click",function(){console.save(places)});var rotatePos=document.getElementById("rot-90-pos"),rotateNeg=document.getElementById("rot-90-neg");rotatePos.addEventListener("click",function(){null!=global.selected&&rotateMesh(global.selected,90)}),rotateNeg.addEventListener("click",function(){null!=global.selected&&rotateMesh(global.selected,-90)}),manager.onProgress=function(e,t,o){},manager.onLoad=function(e,t,o){generateCity()};var global={ready:!1,models:{},selected:null},scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(55,canvas_width/canvas_height,.1,1e3);camera.position.set(0,20,20),scene.add(camera);var renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0});renderer.setSize(canvas_width,canvas_height),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.setClearColor(main_color,1),backHolder.appendChild(renderer.domElement);var tiles=["gras_copy","street","corner","cross","wood_full","wood_half","river","water","water_half","water_corner","water_small_corner","water_corner_inside","water_quarter","water_s","water_island_1","house","single_cross","house_large","power_1"],places=[];loadJSON(base_url_scenes+"scene_2.json",function(e){places=e,tiles.forEach(function(e,t){loadTile(e)})});var gridPositions=createGrid(dimension,offset);window.onresize=function(){canvas_width=backHolder.offsetWidth,canvas_height=backHolder.offsetHeight,camera.aspect=canvas_width/canvas_height,camera.updateProjectionMatrix(),renderer.setSize(canvas_width,canvas_height),Adjust.resize()},Adjust.init({camera:camera,holder:backHolder}),controls=new THREE.OrbitControls(camera),controls.damping=.2,controls.maxPolarAngle=Math.PI/2,controls.minDistance=5,controls.maxDistance=35;var ambient=new THREE.AmbientLight(11184810,1);scene.add(ambient);var spotLight=new THREE.SpotLight(16777215);spotLight.position.set(10,0,10),spotLight.intensity=1,spotLight.castShadow=!0,spotLight.shadowMapWidth=1024,spotLight.shadowMapHeight=1024,spotLight.shadow.camera.near=1,spotLight.shadow.camera.far=5e3,spotLight.shadowBias=-1e-4;var l=50;spotLight.shadow.camera.left=l,spotLight.shadow.camera.right=-l,spotLight.shadow.camera.top=l,spotLight.shadow.camera.bottom=-l,camera.add(spotLight),render(time);